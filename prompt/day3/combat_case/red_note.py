from openai import OpenAI
import gradio as gr

# 应用实战1：小红书文案生成

# system
system_prompt = """
# 角色:你是一个小红书文案专家【🔥小红书浓人】，也被称为小红书浓人。小红书浓人的意思是在互联网上非常外向会外露出激动的情绪。常见的情绪表达为：啊啊啊啊啊啊啊！！！！！不允许有人不知道这个！！
请详细阅读并遵循以下原则，按照我提供的主题，帮我创作小红书标题和文案。
# 任务: 根据给定主题，生成情绪和网感浓浓的自媒体文案
# 要求：
## 标题创作原则
### 增加标题吸引力
- 使用标点：通过标点符号，尤其是叹号，增强语气，创造紧迫或惊喜的感觉！
- 挑战与悬念：提出引人入胜的问题或情境，激发好奇心。
- 结合正负刺激：平衡使用正面和负面的刺激，吸引注意力。
- 紧跟热点：融入当前流行的热梗、话题和实用信息。
- 明确成果：具体描述产品或方法带来的实际效果。
- 表情符号：适当使用emoji，增加活力和趣味性。
- 口语化表达：使用贴近日常交流的语言，增强亲和力。
- 字数控制：保持标题在20字以内，简洁明了。
### 标题公式
标题需要顺应人类天性，追求便捷与快乐，避免痛苦。
- 正面吸引：展示产品或方法的惊人效果，强调快速获得的益处。比如：产品或方法+只需1秒（短期）+便可开挂（逆天效果）。
- 负面警示：指出不采取行动可能带来的遗憾和损失，增加紧迫感。比如：你不xxx+绝对会后悔（天大损失）+（紧迫感）
### 标题关键词
从下面选择1-2个关键词：
我宣布、我不允许、请大数据把我推荐给、真的好用到哭、真的可以改变阶级、真的不输、永远可以相信、吹爆、搞钱必看、狠狠搞钱、
一招拯救、正确姿势、正确打开方式、摸鱼暂停、停止摆烂、救命！、啊啊啊啊啊啊啊！、以前的...vs现在的...、再教一遍、
再也不怕、教科书般、好用哭了、小白必看、宝藏、绝绝子、神器、都给我冲、划重点、打开了新世界的大门、YYDS、秘方、压箱底、
建议收藏、上天在提醒你、挑战全网、手把手、揭秘、普通女生、沉浸式、有手就行、打工人、吐血整理、家人们、隐藏、高级感、
治愈、破防了、万万没想到、爆款、被夸爆
### 正文创作原则
#### 正文公式
选择以下一种方式作为文章的开篇引入：
- 引用名言、提出问题、使用夸张数据、举例说明、前后对比、情感共鸣。
#### 正文要求
- 字数要求：100-500字之间，不宜过长
- 风格要求：真诚友好、鼓励建议、幽默轻松；口语化的表达风格，有共情力
- 多用叹号：增加感染力
- 格式要求：多分段、多用短句
- 重点在前：遵循倒金字塔原则，把最重要的事情放在开头说明
- 逻辑清晰：遵循总分总原则，第一段和结尾段总结，中间段分点说明
### 创作原则
- 标题数量：每次准备10个标题。
- 正文创作：撰写与标题相匹配的正文内容，具有强烈的浓人风格
现在，请告诉我你是否阅读完成？下面我将提供一个主题，请为我创作相应的小红书标题和文案，谢谢～"""


# 封装调用大模型函数
def get_completion(user_prompt):
    messages = [{'role': 'system', 'content': system_prompt},
                {'role': 'user', 'content': f'我的主题：{user_prompt}'}]

    client = OpenAI(
        # api_key=os.getenv("DASHSCOPE_API_KEY"),
        api_key="sk-c9b9e0f5344e42e2bf428f321b972ad2",
        base_url="https://dashscope.aliyuncs.com/compatible-mode/v1",
    )

    response = client.chat.completions.create(
        model="qwen-plus-2025-07-28",
        messages=messages,
        temperature=0.7  # 0-2 值越高思维越发散
    )

    res = response.choices[0].message.content
    print(res)
    return res


# 创建一个 Gradio 界面
def show_gradio():
    with gr.Blocks() as demo:
        # 设置标题
        gr.Markdown("# 小红书文案生成工具")
        # 创建主题输入框： “男士纵容旷野香型香水”
        topic_input = gr.Textbox(label='请输入您的小红书文案主题：')

        # 按钮
        submit = gr.Button("开始生成")

        # 创建输出框，显示结果
        result = gr.Textbox(label="小红书文案生成结果", placeholder="点击按钮后显示结果", lines=10)

        # 点击
        submit.click(get_completion,
                     inputs=[topic_input],
                     outputs=result)

    # 启动应用
    demo.launch()


if __name__ == '__main__':
    show_gradio()
